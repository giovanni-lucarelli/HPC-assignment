\section{Results}

\begin{frame}[fragile]{Thread Scaling}
    \begin{columns}[T]
        \begin{column}{0.35\textwidth}
            \lstset{basicstyle=\ttfamily\scriptsize, language=bash}
            \begin{lstlisting}
    GRID_SIZE_X=16384
    GRID_SIZE_Y=16384
    N_STEPS=500
    
    NODES=1
    N_TASKS_PER_NODE=1
    THREADS="1 2 4 8 16 32 56 84 112"
            \end{lstlisting}
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \centering
                \resizebox{\linewidth}{!}{\input{images/threads_times.pgf}}%
            \end{figure}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Thread Scaling}
\begin{figure}
    \centering{
        \resizebox{0.9\linewidth}{!}{\input{images/threads_speed_eff.pgf}}%
    }
\end{figure}
\end{frame}

\begin{frame}{Node Architecture}
    \begin{figure}
        \includegraphics[width=\textwidth]{./images/node.drawio.pdf}
    \end{figure}
\end{frame}

\begin{frame}[fragile]{Node Architecture: distance matrix}
    \lstset{basicstyle=\ttfamily\scriptsize, language=bash}

    \begin{lstlisting}
[glucarel@lrdn4293 HPC-leonardo]$ numactl --hardware
    available: 8 nodes (0-7)
      node   0   1   2   3   4   5   6   7 
        0:  10  12  12  12  21  21  21  21 
        1:  12  10  12  12  21  21  21  21 
        2:  12  12  10  12  21  21  21  21 
        3:  12  12  12  10  21  21  21  21 
        4:  21  21  21  21  10  12  12  12 
        5:  21  21  21  21  12  10  12  12 
        6:  21  21  21  21  12  12  10  12 
        7:  21  21  21  21  12  12  12  10 
    \end{lstlisting}

\end{frame}

\begin{frame}[fragile]{Strong Scaling (1/2)}
    \begin{columns}[T]
        \begin{column}{0.35\textwidth}
            \vfill
            \lstset{basicstyle=\ttfamily\scriptsize, language=bash}
            \begin{lstlisting}
    GRID_SIZE_X=16384
    GRID_SIZE_Y=16384
    N_STEPS=500

    OMP_THREADS=14
    N_TASKS_PER_NODE=8

    NODES="1 2 4 8 16"
    \end{lstlisting}
    \vfill
        \end{column}
        \begin{column}{0.5\textwidth}
            \begin{figure}
                \centering
                \resizebox{0.9\linewidth}{!}{\input{images/strong_times.pgf}}%
            \end{figure}
        \end{column}
        
    \end{columns}
\end{frame}

\begin{frame}{Strong Scaling (1/2)}
    \begin{figure}
    \centering{
        \resizebox{0.9\linewidth}{!}{\input{images/strong_speed_eff.pgf}}%
    }
\end{figure}
\end{frame}

\begin{frame}[fragile]{Strong Scaling (1/2): Analysis}
    \begin{itemize}
        \item 8 MPI tasks per node $\rightarrow$ one per \textbf{NUMA region}
        \item smaller grid as nodes increase ($8\rightarrow 128$)
        \item for nodes=16 (grid $N = 2^{14}$, 128 tasks = 16 x 8)
        \begin{equation*}
            mem_{128} = 2^{10}\times 2^{11}\times 16 \text{B}= 2^{25} \text{B}\approx 33.5 \text{MB}
        \end{equation*}
    \end{itemize}

        \lstset{basicstyle=\ttfamily\scriptsize, language=bash}
    \begin{lstlisting}
[glucarel@lrdn4293 HPC-leonardo]$ lscpu | egrep 'L1d|L1i|L2|L3'
    L1d cache:           48K
    L1i cache:           32K
    L2 cache:            2048K
    L3 cache:            107520K
    \end{lstlisting}

    Superlinearity comes from better cache effects expoitation!
\end{frame}

\begin{frame}[fragile]{Strong Scaling (2/2)}
    \lstset{basicstyle=\ttfamily\scriptsize, language=bash}
    \begin{lstlisting}
    OMP_THREADS=112
    N_TASKS_PER_NODE=1
    \end{lstlisting}
    \begin{figure}
    \centering{
        \resizebox{0.9\linewidth}{!}{\input{images/strong2_speed_eff.pgf}}%
    }
\end{figure}
\end{frame}

\begin{frame}[fragile]{Strong Scaling (2/2): Analysis}
    \begin{itemize}
        \item 1 MPI tasks per node
        \item smaller grid as nodes increase ($1\rightarrow 16$)
        \item for nodes=16 (grid $N = 2^{14}$, 16 tasks = 4 x 4)
        \begin{equation*}
            mem_{16} = \frac{2^{14}}{4}\times \frac{2^{14}}{4}\times 16 \text{B}= 2^{28} \text{B}\approx 268 \text{MB}
        \end{equation*}
    \end{itemize}

\end{frame}

\begin{frame}[fragile]{Weak Scaling}
    \lstset{basicstyle=\ttfamily\scriptsize, language=bash}
    \begin{lstlisting}
    LOCAL_X=4096
    LOCAL_Y=4096
    OMP_THREADS=14        
    TASKS_PER_NODE=8   

    for NODES in "1 2 4 8 16"; do
        TOTAL_TASKS=$(( NODES * TASKS_PER_NODE ))

        case "${TOTAL_TASKS}" in
        8)    PX=4;  PY=2  ;;   # 1 node  (8 ranks)
        ...
        esac

        GRID_SIZE_X=$(( LOCAL_X * PX ))
        GRID_SIZE_Y=$(( LOCAL_Y * PY ))
        ...
    done
    \end{lstlisting}
\end{frame}

\begin{frame}{Weak Scaling}
    \begin{figure}
    \centering{
        \resizebox{0.9\linewidth}{!}{\input{images/weak_times_eff.pgf}}%
    }
\end{figure}
\end{frame}
